<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>To-Do List</title>
</head>
<body>
    <div id="forms">
        <form>
            <input type="text" name="tarefa" placeholder="Nova tarefa">
            <button type="button" name="ok" onclick="submeter(this.form)">ok</button>
        </form>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDZko3XPnNnQ-zThQLzWfWImMRrNM_vyg0",
        authDomain: "todolist-93f0e.firebaseapp.com",
        databaseURL: "https://todolist-93f0e.firebaseio.com",
        projectId: "todolist-93f0e",
        storageBucket: "",
        messagingSenderId: "16615280625"
      };
      var defaultApp = firebase.initializeApp(config);
      var database = firebase.database();
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            database.ref('/tarefas/').once('value').then(function(snapshot) {
                var tarefas = snapshot.val();
                for(x in tarefas){
                    var formText = '<form id="' + x + '"> \
                                    <input  value="' + tarefas[x].tarefa + '">\
                                    <button type="button" onclick="submeter(this.form)">ok</button>\
                                </form>';
                    var tarefa = $('<input type="text" name="tarefa"></input>')
                                   .attr('value', tarefas[x].tarefa);
                    var button = $('<button type="button" onclick="submeter(this.form)">ok</button>');
                    var form = $('<form></form>')
                                 .attr('id', x);
                    form.append(tarefa)
                        .append(button);

                    $('#forms').append(form);
                }
            });

        });

        function submeter(form) {
            if(!form.id) {
                form.id = database.ref().child('tarefas').push().key;
            }
            
            var tarefa = { tarefa: form.tarefa.value,};
            var update = {};
            update['/tarefas/' + form.id] = tarefa;

            database.ref().update(update);
        }
    </script>
</body>
</html>